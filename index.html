<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Account OTP Dashboard (Theo nhóm)</title>
  <style>
    body { font-family: Arial; padding: 10px; background: #f0f0f0; }
    textarea, select, button, input[type="text"] {
      font-size: 14px; width: 100%; margin-top: 8px; padding: 8px; box-sizing: border-box;
    }
    button {
      background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;
    }
    button:hover { background-color: #0056b3; }
    label { font-weight: bold; margin-top: 10px; display: block; }
  </style>
</head>
<body>
  <h2>Account OTP Dashboard (Theo nhóm)</h2>

  <label>✏️ Nhập tên nhóm (ví dụ: accounts1)</label>
  <input id="groupInput" type="text" placeholder="accounts1" />

  <textarea id="accountInput" rows="5" placeholder="user|pass|email... mỗi dòng 1 tài khoản"></textarea>
  <button onclick="saveAccounts()">💾 Lưu tài khoản</button>
  <button onclick="loadAccounts()">🔄 Tải lại nhóm</button>
  <button onclick="deleteGroup()">❎ Xóa toàn bộ nhóm</button>

  <label>📋 Chọn tài khoản đã lưu:</label>
  <select id="accountSelect" multiple></select>

  <label>🗂 Các nhóm đã có:</label>
  <select id="groupList" onchange="selectExistingGroup()"></select>
  <button onclick="renameGroup()">✏️ Đổi tên nhóm</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const config = {
      apiKey: "AIzaSyAlmrhQkbhMXctil8crZ6GftfH9wAcKA",
      authDomain: "acctiktok-34c22.firebaseapp.com",
      databaseURL: "https://acctiktok-34c22-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "acctiktok-34c22",
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    function saveAccounts() {
      const group = document.getElementById("groupInput").value.trim();
      const input = document.getElementById("accountInput").value.trim();
      if (!group || !input) return alert("Vui lòng nhập tên nhóm và tài khoản.");
      const lines = input.split("\n").filter(line => line.includes("|"));
      db.ref(group).set(lines).then(() => {
        alert("✅ Đã lưu tài khoản.");
        loadGroupList(group);
      });
    }

    function loadAccounts() {
      const group = document.getElementById("groupInput").value.trim();
      if (!group) return;
      db.ref(group).once("value").then(snap => {
        const data = snap.val() || [];
        const select = document.getElementById("accountSelect");
        select.innerHTML = "";
        data.forEach((line, i) => {
          const option = document.createElement("option");
          option.value = i;
          option.textContent = line;
          select.appendChild(option);
        });
      });
    }

    function loadGroupList(selected = "") {
      db.ref().once("value").then(snap => {
        const data = snap.val() || {};
        const list = document.getElementById("groupList");
        list.innerHTML = "";
        for (const key in data) {
          if (Array.isArray(data[key])) {
            const option = document.createElement("option");
            option.value = key;
            option.textContent = key;
            list.appendChild(option);
          }
        }
        if (selected) list.value = selected;
      });
    }

    function selectExistingGroup() {
      const group = document.getElementById("groupList").value;
      document.getElementById("groupInput").value = group;
      loadAccounts();
    }

    function deleteGroup() {
      const group = document.getElementById("groupInput").value.trim();
      if (!group) return alert("Nhập tên nhóm!");
      if (!confirm("Bạn có chắc muốn xóa nhóm " + group + "?")) return;
      db.ref(group).remove().then(() => {
        alert("🗑️ Đã xóa nhóm.");
        document.getElementById("accountSelect").innerHTML = "";
        document.getElementById("accountInput").value = "";
        loadGroupList();
      });
    }

    function renameGroup() {
      const oldName = document.getElementById("groupInput").value.trim();
      if (!oldName) return alert("⛔ Nhập nhóm muốn đổi tên.");
      const newName = prompt("Nhập tên mới cho nhóm:", oldName);
      if (!newName || newName === oldName) return;

      db.ref(oldName).once("value").then(snapshot => {
        const data = snapshot.val();
        if (!data) return alert("⛔ Không tìm thấy nhóm cũ!");

        db.ref(newName).set(data).then(() => {
          db.ref(oldName).remove().then(() => {
            alert("✅ Đã đổi tên nhóm!");
            document.getElementById("groupInput").value = newName;
            loadGroupList(newName);
            loadAccounts();
          });
        });
      });
    }

    loadGroupList();
  </script>
</body>
</html>
