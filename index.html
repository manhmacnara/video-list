<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Account OTP Dashboard (Theo nhÃ³m)</title>
  <style>
    body { font-family: Arial; padding: 10px; background: #f0f0f0; }
    textarea, select, button, input[type="text"] {
      font-size: 14px; width: 100%; margin-top: 8px; padding: 8px; box-sizing: border-box;
    }
    button {
      background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;
    }
    button:hover { background-color: #0056b3; }
    label { font-weight: bold; margin-top: 10px; display: block; }
  </style>
</head>
<body>
  <h2>Account OTP Dashboard (Theo nhÃ³m)</h2>

  <label>âœï¸ Nháº­p tÃªn nhÃ³m (vÃ­ dá»¥: accounts1)</label>
  <input id="groupInput" type="text" placeholder="accounts1" />

  <textarea id="accountInput" rows="5" placeholder="user|pass|email... má»—i dÃ²ng 1 tÃ i khoáº£n"></textarea>
  <button onclick="saveAccounts()">ğŸ’¾ LÆ°u tÃ i khoáº£n</button>
  <button onclick="loadAccounts()">ğŸ”„ Táº£i láº¡i nhÃ³m</button>
  <button onclick="deleteGroup()">â XÃ³a toÃ n bá»™ nhÃ³m</button>

  <label>ğŸ“‹ Chá»n tÃ i khoáº£n Ä‘Ã£ lÆ°u:</label>
  <select id="accountSelect" multiple></select>

  <label>ğŸ—‚ CÃ¡c nhÃ³m Ä‘Ã£ cÃ³:</label>
  <select id="groupList" onchange="selectExistingGroup()"></select>
  <button onclick="renameGroup()">âœï¸ Äá»•i tÃªn nhÃ³m</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const config = {
      apiKey: "AIzaSyAlmrhQkbhMXctil8crZ6GftfH9wAcKA",
      authDomain: "acctiktok-34c22.firebaseapp.com",
      databaseURL: "https://acctiktok-34c22-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "acctiktok-34c22",
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    function saveAccounts() {
      const group = document.getElementById("groupInput").value.trim();
      const input = document.getElementById("accountInput").value.trim();
      if (!group || !input) return alert("Vui lÃ²ng nháº­p tÃªn nhÃ³m vÃ  tÃ i khoáº£n.");
      const lines = input.split("\n").filter(line => line.includes("|"));
      db.ref(group).set(lines).then(() => {
        alert("âœ… ÄÃ£ lÆ°u tÃ i khoáº£n.");
        loadGroupList(group);
      });
    }

    function loadAccounts() {
      const group = document.getElementById("groupInput").value.trim();
      if (!group) return;
      db.ref(group).once("value").then(snap => {
        const data = snap.val() || [];
        const select = document.getElementById("accountSelect");
        select.innerHTML = "";
        data.forEach((line, i) => {
          const option = document.createElement("option");
          option.value = i;
          option.textContent = line;
          select.appendChild(option);
        });
      });
    }

    function loadGroupList(selected = "") {
      db.ref().once("value").then(snap => {
        const data = snap.val() || {};
        const list = document.getElementById("groupList");
        list.innerHTML = "";
        for (const key in data) {
          if (Array.isArray(data[key])) {
            const option = document.createElement("option");
            option.value = key;
            option.textContent = key;
            list.appendChild(option);
          }
        }
        if (selected) list.value = selected;
      });
    }

    function selectExistingGroup() {
      const group = document.getElementById("groupList").value;
      document.getElementById("groupInput").value = group;
      loadAccounts();
    }

    function deleteGroup() {
      const group = document.getElementById("groupInput").value.trim();
      if (!group) return alert("Nháº­p tÃªn nhÃ³m!");
      if (!confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a nhÃ³m " + group + "?")) return;
      db.ref(group).remove().then(() => {
        alert("ğŸ—‘ï¸ ÄÃ£ xÃ³a nhÃ³m.");
        document.getElementById("accountSelect").innerHTML = "";
        document.getElementById("accountInput").value = "";
        loadGroupList();
      });
    }

    function renameGroup() {
      const oldName = document.getElementById("groupInput").value.trim();
      if (!oldName) return alert("â›” Nháº­p nhÃ³m muá»‘n Ä‘á»•i tÃªn.");
      const newName = prompt("Nháº­p tÃªn má»›i cho nhÃ³m:", oldName);
      if (!newName || newName === oldName) return;

      db.ref(oldName).once("value").then(snapshot => {
        const data = snapshot.val();
        if (!data) return alert("â›” KhÃ´ng tÃ¬m tháº¥y nhÃ³m cÅ©!");

        db.ref(newName).set(data).then(() => {
          db.ref(oldName).remove().then(() => {
            alert("âœ… ÄÃ£ Ä‘á»•i tÃªn nhÃ³m!");
            document.getElementById("groupInput").value = newName;
            loadGroupList(newName);
            loadAccounts();
          });
        });
      });
    }

    loadGroupList();
  </script>
</body>
</html>
